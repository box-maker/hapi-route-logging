{"version":3,"sources":["../src/index.js"],"names":["optionsSchema","showRoutes","boolean","default","showRoutesList","checkUpgrade","language","string","register","server","options","next","checkOptions","validate","error","value","undefined","changeLanguage","on","console","log","introMessage","t","uri","info","quitText","quitMessage","bgYellow","black","serverHapiVersion","version","then","gt","bgRed","red","request","date","Date","received","dateText","toLocaleDateString","toLocaleTimeString","infoText","green","method","toUpperCase","url","path","statusCode","typeText","errorText","response","parseInt","source","message","blue","protocol","err","totalTime","responded","totalTimeText","output","bold","italic","underline","attributes","pkg","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["'use strict';\n\nimport chalk from 'chalk';\nimport Joi from 'joi';\nimport latestVersion from 'latest-version';\nimport semver from 'semver';\n\nimport packageJson from '../package.json';\nimport {formatRoutes} from './route-list';\nimport {i18n} from './language';\n\nconst optionsSchema = {\n  showRoutes: Joi.boolean().default(true),\n  showRoutesList: Joi.boolean().default(false),\n  checkUpgrade: Joi.boolean().default(false),\n  language: Joi.string()\n};\n\nfunction register(server, options, next) {\n  const checkOptions = Joi.validate(options, optionsSchema);\n  if (checkOptions.error) {\n    throw checkOptions.error;\n  }\n  options = checkOptions.value;\n\n  if (options.language !== undefined) {\n    i18n.changeLanguage(options.language);\n  }\n\n  server.on('start', () => {\n    if (options.showRoutesList) {\n      formatRoutes(server);\n    }\n\n    console.log('\\n');\n    const introMessage = i18n.t('introMessage', {uri: server.info.uri});\n    const quitText = 'CTRL-C';\n    const quitMessage = `${i18n.t('quitMessage')} ${chalk.bgYellow.black(quitText)}.`;\n    const serverHapiVersion = server.version;\n    if (options.checkUpgrade) {\n      latestVersion('hapi').then(version => {\n        if (semver.gt(version, serverHapiVersion)) {\n          console.log(`${introMessage} ${chalk.bgRed(serverHapiVersion)}`);\n          console.log(chalk.red(`\\t ${i18n.t('upgradeHapi')} ${version}`));\n        } else {\n          console.log(`${introMessage} ${serverHapiVersion}`);\n        }\n        console.log(quitMessage);\n      });\n    } else {\n      console.log(`${introMessage} ${serverHapiVersion}`);\n      console.log(quitMessage);\n    }\n  });\n\n  if (options.showRoutes) {\n    server.on('response', request => {\n      // TODO: Support multiple connections (https://hapijs.com/api#serverconnections)\n      const date = new Date(request.info.received);\n      const dateText = `[${date.toLocaleDateString()} ${date.toLocaleTimeString()}]`;\n\n      const infoText = chalk.green(`\"${request.method.toUpperCase()} ${request.url.path}\"`);\n\n      let statusCode;\n      let typeText;\n      let errorText = null;\n      try {\n        statusCode = request.response.statusCode;\n        if (parseInt(statusCode, 10) >= 400) {\n          statusCode = chalk.black.bgRed(statusCode);\n          typeText = chalk.red('ERROR');\n          errorText = request.response.source.message;\n        } else {\n          typeText = chalk.blue(server.info.protocol.toUpperCase());\n        }\n      } catch (err) {\n        statusCode = '';\n      }\n\n      const totalTime = new Date(request.info.responded) - new Date(request.info.received);\n      const totalTimeText = chalk.red(`${totalTime}ms`);\n\n      const output = `${dateText} [${typeText}] ${infoText} ${statusCode} ${totalTimeText}`;\n      console.log(output);\n      if (errorText) {\n        console.error(`\\t${chalk.bold('Error')}: ${chalk.italic.underline(errorText)}`);\n      }\n    });\n  }\n\n  return next();\n}\n\nregister.attributes = {\n  pkg: packageJson\n};\n\nmodule.exports = register;\n"]}